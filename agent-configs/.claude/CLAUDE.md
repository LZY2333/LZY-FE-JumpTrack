# 全局行为规范

## 代码操作必须先生成计划

对任何代码的**新增、删除、修改**操作，必须遵循以下流程：

1. 允许 web search 收集必要信息
2. 允许与用户多轮对话澄清需求
3. **先输出完整的执行步骤和即将进行的操作**，包括：
    - 涉及的文件
    - 具体改动内容
    - 执行的命令
4. **等待用户明确同意后**，再开始执行
5. 用户同意即代表该任务所有操作权限均已授权，无需再次询问

## 大量 token 消耗需要审批

以下操作会消耗大量 token，执行前必须先向用户说明意图并等待同意：

1. **启动 Task 子 agent**（Explore、Plan、general-purpose 等）
2. **并发调用多个工具**（同一条消息中调用 3 个及以上工具）
3. **大范围代码库搜索**（跨多个目录的 Grep/Glob 组合查询）

审批流程：

- 说明「打算做什么」「会用到哪些工具/agent」「预计涉及哪些文件范围」「预估token消耗」
- 等待用户明确同意后再执行
- 用户同意即代表本次操作相关指令已授权，无需逐个确认

## 文件路径引用规范

每次回复中涉及文件路径时，在回复末尾附上跳转列表：

- 所有文件统一使用绝对路径
- 格式：`path:line`，每行一个，按出现顺序排列，不重复
- 若行号未知，使用 `:1`
